<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="robots" content="noindex">
	<title>【js_09】フォーム要素の操作方法</title>
	<!--css-->
	<link rel="stylesheet" href="../css/base.css" media="all">
	<!--js-->
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
</head>

<body>
<h1>【Chapter9】フォーム要素の操作方法【161〜179】</h1>
<section>
<h2><b>161</b>テキストボックスの情報を取得する</h2>
<table>
	<tr>
		<th>プロパティ</th>
		<th>意味</th>
		<th>型</th>
	</tr>
	<tr>
		<td>インプット要素.value</td>
		<td>入力欄の文字列</td>
		<td>文字列</td>
	</tr>
</table>
<ul>
	<li>valueプロパティでアクセス</li>
	<li>valueプロパティは文字列（String型）</li>
</ul>
<h4>SAMPLE #161<b>テキストボックスの値を取得</b></h4>
<form action="">
	<input type="text" placeholder="テキストを入力" id="input161">
</form>
<p class="btn" onclick="sec161()">SAMPLE #161</p>
<pre><code>const value161 = document.querySelector('#input161').value;
if (value161) {
	alert(value161);
} else {
	alert('テキストを入力してください');
}</code></pre>
</section><!-- section -->

<section>
<h2><b>162</b>テキストボックスの変更を検知する</h2>
<table>
	<tr>
		<th>イベント名</th>
		<th>意味</th>
	</tr>
	<tr>
		<td>change</td>
		<td>input要素の変更時のイベント</td>
	</tr>
	<tr>
		<td>input</td>
		<td>input要素のキー入力時のイベント</td>
	</tr>
</table>
<ul>
	<li>値の変化を検知するにはchangeイベント、inputイベントを監視する</li>
	<li>要素を参照し、addEventListener()でイベントハンドラーを設定する</li>
	<li>inputはキー入力と同時にイベント発生</li>
	<li>changeはEnterを押したときやフォーカスが外れたときにイベント発生</li>
</ul>
<h4>SAMPLE #162<b>テキストボックスの変更を検知</b></h4>
<form action="" id="form162">
	<input type="text" placeholder="テキストを入力" id="input162">
</form>
<div class="result162i" style="margin-top: 10px;">入力されたテキストが表示されます（input）</div>
<div class="result162c" style="margin-top: 10px;">入力されたテキストが表示されます（change）</div>
<pre><code>const form162 = document.querySelector('#form162');
const input162 = document.querySelector('#input162');
const result162i = document.querySelector('.result162i');
const result162c = document.querySelector('.result162c');

input162.addEventListener('input', handleInput);
input162.addEventListener('change', handleChange);

function handleInput(event) {
	const value162 = event.target.value;
	result162i.innerHTML = value162;
}
function handleChange(event) {
	const value162 = event.target.value;
	result162c.innerHTML = value162;
}
//enterで遷移させない
form162.addEventListener('submit', (e) => {
	if (e.target.type !== "submit") {
		e.preventDefault();
	}
});</code></pre>
</section><!-- section -->

<section>
<h2><b>163</b>テキストエリアの情報を取得する</h2>
<table>
	<tr>
		<th>プロパティ</th>
		<th>意味</th>
		<th>型</th>
	</tr>
	<tr>
		<td>テキストエリア要素.value</td>
		<td>入力欄の文字列</td>
		<td>文字列</td>
	</tr>
</table>
<ul>
	<li>valueプロパティでアクセス</li>
	<li>valueプロパティは文字列（String型）</li>
</ul>
<h4>SAMPLE #163<b>テキストエリアの値を取得</b></h4>
<form action="">
	<textarea placeholder="テキストを入力" id="input163" cols="30" rows="10"></textarea>
</form>
<p class="btn" onclick="sec163()">SAMPLE #163</p>
<pre><code>const value163 = document.querySelector('#input163').value;
if (value163) {
	alert(value163);
} else {
	alert('テキストを入力してください');
}</code></pre>
</section><!-- section -->

<section>
<h2><b>164</b>テキストエリアの変更を検知する</h2>
<table>
	<tr>
		<th>イベント名</th>
		<th>意味</th>
	</tr>
	<tr>
		<td>change</td>
		<td>textarea要素の変更時のイベント</td>
	</tr>
	<tr>
		<td>input</td>
		<td>textarea要素のキー入力時のイベント</td>
	</tr>
</table>
<ul>
	<li>inputはキー入力と同時にイベント発生</li>
	<li>changeはEnterを押したときやフォーカスが外れたときにイベント発生</li>
</ul>
<h4>SAMPLE #164<b>テキストエリアの変更を検知</b></h4>
<form action="" id="form164">
	<textarea placeholder="テキストを入力" id="input164" cols="30" rows="10"></textarea>
</form>
<div class="result164i" style="margin-top: 10px;">入力されたテキストが表示されます（input 改行変換あり）</div>
<div class="result164c" style="margin-top: 10px;">入力されたテキストが表示されます（change 改行変換なし）</div>
<pre><code>const input164 = document.querySelector('#input164');
const result164i = document.querySelector('.result164i');
const result164c = document.querySelector('.result164c');
input164.addEventListener('input', handleInput);
input164.addEventListener('change', handleChange);
function handleInput(event) {
	const value164 = event.target.value;
	const htmlstr = value164.split('\n').join('<br>');
	result164i.innerHTML = htmlstr;
}
function handleChange(event) {
	const value164 = event.target.value;
	result164c.innerHTML = value164;
}</code></pre>
</section><!-- section -->

<section>
<h2><b>165</b>チェックボックスの情報を取得する</h2>
<table>
	<tr>
		<th>プロパティ</th>
		<th>意味</th>
		<th>型</th>
	</tr>
	<tr>
		<td>インプット要素.checked</td>
		<td>選択状態であるか</td>
		<td>真偽値</td>
	</tr>
</table>
<ul>
	<li>checkedプロパティでアクセス</li>
	<li>checkedプロパティでは真偽値（Boolean型）</li>
</ul>
</section><!-- section -->

<section>
<h2><b>166</b>テキストボックスの変更を検知する</h2>
<table>
	<tr>
		<th>イベント名</th>
		<th>意味</th>
	</tr>
	<tr>
		<td>change</td>
		<td>input要素の変更時のイベント</td>
	</tr>
</table>
<h4>SAMPLE #166<b>チェックボックスの情報を取得</b></h4>
<form action="" id="form166">
	<label for="checkA" style="margin-right: 20px;">
		<input type="checkbox" id="checkA" class="check166">
		checkboxA
	</label>
	<label for="checkB" style="margin-right: 20px;">
		<input type="checkbox" id="checkB" class="check166">
		checkboxB
	</label>
	<label for="checkC" style="margin-right: 20px;">
		<input type="checkbox" id="checkC" class="check166">
		checkboxC
	</label>
	<label for="checkAll" style="margin-right: 20px;">
		<input type="checkbox" id="checkAll" value="All">
		すべて選択する
	</label>
</form>
<ul>
	<li>checkboxA : <span class="checkA">false</span></li>
	<li>checkboxB : <span class="checkB">false</span></li>
	<li>checkboxC : <span class="checkC">false</span></li>
</ul>
<pre><code>const checkedA = document.querySelector('#checkA');
const checkedB = document.querySelector('#checkB');
const checkedC = document.querySelector('#checkC');

//各ボタン
document.querySelectorAll('.check166').forEach(function (checkBtn) {
	checkBtn.addEventListener('change', () => {
		checkResult();
	});
});

//すべて選択ボタン
document.querySelector('#checkAll').addEventListener('click', (e) => {
	if (e.target.checked == true) {
		checkedA.checked = checkedB.checked = checkedC.checked = true;
	} else {
		checkedA.checked = checkedB.checked = checkedC.checked = false;
	}
	checkResult();
});

function checkResult() {
	document.querySelector('.checkA').innerHTML = checkedA.checked;
	document.querySelector('.checkB').innerHTML = checkedB.checked;
	document.querySelector('.checkC').innerHTML = checkedC.checked;
}</code></pre>
</section><!-- section -->

<section>
<h2><b>167</b>ローカルファイルの情報を取得する</h2>
<table>
	<tr>
		<th>プロパティ</th>
		<th>意味</th>
		<th>型</th>
	</tr>
	<tr>
		<td>インプット要素.files</td>
		<td>選択されたファイルの配列</td>
		<td>配列</td>
	</tr>
</table>
<ul>
	<li>changeイベントが発生したときに発行されるイベントでevent.target.filesプロパティを参照することで、inputに指定されたファイルリストを取得できる</li>
	<li>multiple属性を指定すると複数ファイルのアップロードができる</li>
</ul>
<h4>SAMPLE #167<b>ローカルファイルの情報を取得</b></h4>
<form action="">
	<input type="file" id="input167">
</form>
<pre><code>const input167 = document.querySelector('#input167');
input167.addEventListener('change', (e) => {
	const files = e.target.files;    //ファイルの配列
	const file = files[0];
	alert(`${file.name}が選択されました`);
});</code></pre>
</section><!-- section -->

<section>
<h2><b>168</b>ローカルファイルをテキストとして読み込む</h2>
<table>
	<tr>
		<th>メソッド</th>
		<th>意味</th>
		<th>戻り値</th>
	</tr>
	<tr>
		<td>readAsText(ファイル)</td>
		<td>テキストとして読み込む</td>
		<td>なし</td>
	</tr>
</table>
<ul>
	<li>選択したファイルのデータにアクセスするには、FileReaderオブジェクトを使う</li>
	<li>FileReaderオブジェクトのreadAsText()を使うとテキストファイルとして読み込める</li>
	<li>読み込みは非同期のためloadイベントを監視する</li>
	<li>loadイベント完了後、FileReaderオブジェクトのresultプロパティでデータへのアクセスが可能</li>
</ul>
<h4>SAMPLE #168<b>ローカルファイルをテキストとして読み込む</b></h4>
<form action="">
	<input type="file" id="input168" accept=".txt">
	<p class="log168">テキストの内容を表示</p>
</form>
<pre><code>const input168 = document.querySelector('#input168');
const log  = document.querySelector('.log')
input168.addEventListener('input', (e) => {
	const files = e.target.files;
	const file = files[0];
	//FileReaderのインスタンス作成
	const reader = new FileReader();
	reader.addEventListener('load', () => {
		//load後resultを.logに出力
		log.textContent = reader.result;
	});
	//テキストファイルとして読み込む
	reader.readAsText(file);
});</code></pre>
<a href="http://catprogram.hatenablog.com/entry/2015/04/23/171157" target="_blank" style="display: inline-block">File API参考（文字コード判定とか）</a>
</section><!-- section -->

<section>
<h2><b>169</b>ローカルファイルをDataURLデータとして読み込む</h2>
<table>
	<tr>
		<th>メソッド</th>
		<th>意味</th>
		<th>戻り値</th>
	</tr>
	<tr>
		<td>readAsDataURL(ファイル)</td>
		<td>DataURLとして読み込む</td>
		<td>なし</td>
	</tr>
</table>
<ul>
	<li>選択したファイルのデータにアクセスするには、FileReaderオブジェクトを使う</li>
	<li>FileReaderオブジェクトのreadAsDataURL()を使うとDataURLとして読み込める</li>
	<li>読み込みは非同期のためloadイベントを監視する</li>
	<li>loadイベント完了後、FileReaderオブジェクトのresultプロパティでデータへのアクセスが可能</li>
</ul>
<h4>SAMPLE #169<b>ローカルファイルをDataURLとして読み込む</b></h4>
<form action="">
	<input type="file" id="input169" accept=".png, .jpg">
	<p class="log169">ファイルの内容を表示<img /></p>
</form>
<pre><code>const input169 = document.querySelector('#input169');
const log = document.querySelector('.log169 img');
input169.addEventListener('input', (e) => {
	const files = e.target.files;
	const file = files[0];
	//FileReaderのインスタンス作成
	const reader = new FileReader();
	reader.addEventListener('load', () => {
		//load後resultを.logに出力
		log.src = reader.result;
	});
	//テキストファイルとして読み込む
	reader.readAsDataURL(file);
});</code></pre>
</section><!-- section -->

<section>
<h2><b>170</b>ラジオボタンの情報を取得する</h2>
<table>
	<tbody><tr>
		<th>プロパティ</th>
		<th>意味</th>
		<th>型</th>
	</tr>
	<tr>
		<td>フォーム要素[キー名]</td>
		<td>ラジオボタンの値</td>
		<td>文字列</td>
	</tr>
</tbody></table>
<ul>
	<li>複数のラジオボタンはname属性でグループ化される</li>
	<li>form要素の中にname属性で定義したラジオボタンのグループが登録されている</li>
	<li>これらのvalue値を確認する</li>
</ul>
<pre><code>const element = document.querySelector('form');    //form
const drinkValue = element.drink.value;    //name属性がdrinkのグループのvalue

console.log(`drinkの値は${drinkValue}です`);
</code></pre>
</section><!-- section -->

<section>
<h2><b>171</b>ラジオボタンの変更を検知する</h2>
<table>
	<tbody><tr>
		<th>イベント名</th>
		<th>意味</th>
	</tr>
	<tr>
		<td>change</td>
		<td>form要素の変更時のイベント</td>
	</tr>
</tbody></table>
<ul>
	<li>form要素に対してchangeイベントを監視する</li>
</ul>
<h4>SAMPLE #171<b>ラジオボタンの変更を検知</b></h4>
<form action="" id="form171">
	<div style="padding-top: 10px">
		<label><input type="radio" name="color" value="red">red</label>
		<label><input type="radio" name="color" value="blue">blue</label>
		<label><input type="radio" name="color" value="yellow">yellow</label>
		<p class="color171">colorの値は<span style="color: #faff68;"></span></p>
	</div>
	<div style="margin-top: 20px">
		<label><input type="radio" name="food" value="kome">kome</label>
		<label><input type="radio" name="food" value="pan">pan</label>
		<label><input type="radio" name="food" value="men">men</label>
		<p class="food171">foodの値は<span style="color: #faff68;"></span></p>
	</div>
</form>
<pre><code>const form171 = document.querySelector('#form171');
const color171 = document.querySelector('.color171 span');
const food171 = document.querySelector('.food171 span');
form171.addEventListener('change', handleChange);

function handleChange(e) {
	const colorValue = form171.color.value;
	const foodValue = form171.food.value;
	color171.innerHTML = colorValue;
	food171.innerHTML = foodValue;
}</code></pre>
</section><!-- section -->

<section>
<h2><b>172</b>ドロップダウンメニューの情報を取得する</h2>
<table>
	<tbody><tr>
		<th>プロパティ</th>
		<th>意味</th>
		<th>型</th>
	</tr>
	<tr>
		<td>セレクト要素.value</td>
		<td>選択された項目の値</td>
		<td>文字列</td>
	</tr>
</tbody></table>
<ul>
	<li>select要素とoptionで作成されたドロップダウンメニューを調べる</li>
	<li>select要素を参照しvalueを調べる</li>
	<li>select要素の値を変更するにはvalueに値を代入する</li>
</ul>
<pre><code>conse element = document.querySelector('select');    //select
const value = element.value;    //valueの取得
console.log(`選択されているのは${value}です`);
</code></pre>
</section><!-- section -->

<section>
<h2><b>173</b>ドロップダウンメニューの変更を検知する</h2>
<table>
	<tbody><tr>
		<th>イベント名</th>
		<th>意味</th>
	</tr>
	<tr>
		<td>change</td>
		<td>select要素の変更時のイベント</td>
	</tr>
</tbody></table>
<ul>
	<li>select要素に対してchangeイベントを監視する</li>
</ul>
<h4>SAMPLE #173<b>ドロップダウンメニューの変更を検知</b></h4>
<form action="">
	<select id="select173">
		<option value="kome">kome</option>
		<option value="pan">pan</option>
		<option value="men">men</option>
	</select>
	<p class="result173">選択されているのは<span style="color: #faff68;">kome</span>です</p>
</form>
</section><!-- section -->

<section>
<h2><b>174</b>スライダーの情報を取得する</h2>
<table>
	<tbody><tr>
		<th>プロパティ</th>
		<th>意味</th>
		<th>型</th>
	</tr>
	<tr>
		<td>インプット要素.value　※input type="range"</td>
		<td>スライダーの現在値</td>
		<td>文字列</td>
	</tr>
</tbody></table>
<ul>
	<li>スライダーはmin属性とmax属性の範囲で値をユーザーが設定できる</li>
	<li>input要素を参照しvalueを調べる</li>
	<li>valueは数値ではなく、文字列（String型）なので注意</li>
</ul>
<h4>SAMPLE #174<b>スライダーの情報を取得</b></h4>
<form action="">
	<div style="display: inline-block">0<input type="range" id="range174" min="0" max="100" value="0">100</div>
	<p class="result174" style="color: #faff68; display: inline-block; padding-left: 20px">0</p>
</form>
<p class="btn" id="btn174" onclick="sec174()">値を取得</p>
<pre><code>const range174 = document.querySelector('#range174');
const result174 = document.querySelector('.result174');
const value174 = range174.value;
result174.innerHTML = value174;</code></pre>
</section><!-- section -->

<section>
<h2><b>175</b>スライダーの変更を検知する</h2>
<table>
	<tr>
		<th>イベント名</th>
		<th>意味</th>
	</tr>
	<tr>
		<td>input</td>
		<td>input要素の変更時のイベント</td>
	</tr>
	<tr>
		<td>change</td>
		<td>input要素の変更時のイベント</td>
	</tr>
</table>
<ul>
	<li>inputイベントは、スライダーを動かしている最中も発生</li>
	<li>changeイベントは、スライダーを動かし終わると発生</li>
</ul>
<h4>SAMPLE #175<b>スライダーの変更を検知</b></h4>
<form action="">
	<div style="display: inline-block">0<input type="range" id="range175" min="0" max="100" value="0">100</div>
	<p class="result175i" style="color: #faff68; display: inline-block; padding-left: 20px">0</p>
	<p class="result175c" style="color: #faff68; display: inline-block; padding-left: 20px">0</p>
</form>
<pre><code>const range175 = document.querySelector('#range175');
const result175i = document.querySelector('.result175i');
const result175c = document.querySelector('.result175c');
range175.addEventListener('input', handleInput);
range175.addEventListener('change', handleChange);
function handleInput(e) {
	const value175 = e.target.value;
	result175i.innerHTML = value175;
}
function handleChange(e) {
	const value175 = e.target.value;
	result175c.innerHTML = value175;
}</code></pre>
</section><!-- section -->

<section>
<h2><b>176</b>カラーピッカーの情報を取得する</h2>
<table>
	<tbody><tr>
		<th>プロパティ</th>
		<th>意味</th>
		<th>型</th>
	</tr>
	<tr>
		<td>インプット要素.value　※input type="color"</td>
		<td>カラーピッカーで選択された色</td>
		<td>文字列</td>
	</tr>
</tbody></table>
<ul>
	<li>input要素を参照しvalueを調べる</li>
	<li>valueは文字列（String型）</li>
</ul>
<p><a href="https://developer.mozilla.org/ja/docs/Web/HTML/Element/Input/color" target="_blank">※カラーピッカーに対応していないブラウザあり</a></p>
<h4>SAMPLE #176<b>カラーピッカーの情報を取得</b></h4>
<form action="">
	<input type="color" id="color176">
</form>
<p class="btn" id="btn176" onclick="sec176()">値を取得</p>
<pre><code>const color176 = document.querySelector('#color176');
const value176 = color176.value;
alert(value176);</code></pre>
</section><!-- section -->

<section>
<h2><b>177</b>カラーピッカーの変更を検知する</h2>
<table>
	<tr>
		<th>イベント名</th>
		<th>意味</th>
	</tr>
	<tr>
		<td>change</td>
		<td>input要素の変更時のイベント</td>
	</tr>
</table>
<h4>SAMPLE #177<b>カラーピッカーの変更を検知</b></h4>
<form action="">
	<input type="color" id="color177">
	<p class="result177" style="display: inline-block; padding-left: 20px; width: 100px;">色を表示</p>
</form>
<pre><code>const color177 = document.querySelector('#color177');
const result177 = document.querySelector('.result177');
color177.addEventListener('change', (e) => {
	const value177 = e.target.value;
	result177.innerHTML = value177;
	result177.style.backgroundColor = value177;
});</code></pre>
</section><!-- section -->

<section>
<h2><b>178</b>都道府県のプルダウンをつくる</h2>
<ul>
	<li>JISコードで都道府県のIDが定められている</li>
	<li>動的にoption要素を作成する</li>
</ul>
<h4>SAMPLE #178<b>都道府県のプルダウンをつくる</b></h4>
<select id="pref"></select>
<p class="log178"></p>
<pre><code>//JISコードに対応した都道府県の連想配列
const prefList = [
	{ value: 1, name: '北海道' },
	{ value: 2, name: '青森県' },
	{ value: 3, name: '岩手県' },
	{ value: 4, name: '宮城県' },
	//省略
	{ value: 47, name: '沖縄県' }
];
//select
const selectElement = document.querySelector('#pref');
//option初期表示
let optionString = '&lt;option value=""&gt;選択ください&lt;/option&gt;';
//optionを配列から作成
prefList.forEach((item) => {
	//都道府県ごとにvalueとnameを反映
	optionString += `&lt;option value="${item.value}"&gt;${item.name}&lt;/option&gt;`;
});
//optionをselectに追加
selectElement.innerHTML = optionString;
//変更時のイベント
selectElement.addEventListener('change', (e) => {
	//現在の値
	const index = e.target.selectedIndex;
	const value178 = e.target.options[index].text;
	console.log(value178);
	//メッセージ作成（三項演算子）
	const message = value178 === '' ? '選択されていません' : `選択されているのは${value178}です`;
	document.querySelector('.log178').innerHTML = message;
});</code></pre>
<a href="http://hensa40.cutegirl.jp/archives/380" target="_blank">valueじゃなくnameのテキストを出力したい（載ってない）参考</a>
</section><!-- section -->

<section>
<h2><b>179</b>フォームの送信時に処理を行う</h2>
<table>
	<tr>
		<th>イベント名</th>
		<th>意味</th>
	</tr>
	<tr>
		<td>submit</td>
		<td>フォーム送信時のイベント</td>
	</tr>
</table>
<ul>
	<li>form要素のsubmitイベントを監視しることで、送信前に処理を挟める</li>
	<li>送信前にデータを加工したり、ユーザーに再確認を促したりできる</li>
	<li>送信をキャンセルして再入力させる場合、event.preventDefault()でイベントをキャンセルする</li>
</ul>
<h4>SAMPLE #179<b>フォームの送信時に処理を行う</b></h4>
<form action="" id="form179">
	<label for="txt">テキストを入力</label>
	<input type="text" name="txt" id="txt179">
	<button>送信する</button>
</form>
</section><!-- section -->

<p id="top"><a href="../index.html">TOPに戻る</a></p>
<script src="../js/09.js"></script>
</body>

</html>