<!DOCTYPE html>
<html lang="ja">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="robots" content="noindex">
	<title>【js_05】日付や時間の取り扱い</title>
	<!--css-->
	<link rel="stylesheet" href="../css/base.css" media="all">
	<!--js-->
	<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
</head>

<body>
<h1>【Chapter5】日付や時間の取り扱い【82〜93】</h1>
<section>
<h2><b>082</b>西暦を取得する</h2>
<table>
	<tr>
		<th>メソッド</th>
		<th>意味</th>
		<th>戻り値</th>
	</tr>
	<tr>
		<td>getFullYear()</td>
		<td>西暦を取得</td>
		<td>数値</td>
	</tr>
</table>
<ul>
	<li>DateオブジェクトのgetFullYear()を利用する</li>
	<li>new　Date()でインスタンス化した時点での年を取得</li>
</ul>
<h4>SAMPLE #082<b>西暦の取得</b></h4>
<pre><code>const date = new Date();
const year = date.getFullYear();

alert(`今年は西暦${year}年です`);</code></pre>
<p class="btn" onclick="sec082()">SAMPLE #082</p>
</section><!-- section -->

<section>
<h2><b>083</b>日付を取得する</h2>
<table>
	<tr>
		<th>メソッド</th>
		<th>意味</th>
		<th>戻り値</th>
	</tr>
	<tr>
		<td>getMonth()</td>
		<td>月を取得する</td>
		<td>数値</td>
	</tr>
	<tr>
		<td>getDate()</td>
		<td>日を取得する</td>
		<td>数値</td>
	</tr>
</table>
<ul>
	<li>getMonth()は0を起点とした数値のため1を加算して使う</li>
</ul>
<h4>SAMPLE #083<b>月と日の取得</b></h4>
<pre><code>const date = new Date();
const month = date.getMonth() + 1;
const day = date.getDate();

alert(`今日は${month}月${day}日です`);</code></pre>
<p class="btn" onclick="sec083()">SAMPLE #083</p>
</section><!-- section -->

<section>
<h2><b>084</b>時刻の取得</h2>
<table>
	<tr>
		<th>メソッド</th>
		<th>意味</th>
		<th>戻り値</th>
	</tr>
	<tr>
		<td>getHours()</td>
		<td>時間を取得</td>
		<td>数値</td>
	</tr>
	<tr>
		<td>getMinutes()</td>
		<td>分数を取得</td>
		<td>数値</td>
	</tr>
	<tr>
		<td>getSeconds()</td>
		<td>秒数を取得</td>
		<td>数値</td>
	</tr>
	<tr>
		<td>getMilliseconds()</td>
		<td>ミリ秒数（1000分の1秒）を取得</td>
		<td>数値</td>
	</tr>
</table>
<ul>
	<li>getHours()は0〜23の整数を返す（24時の場合0が返る）</li>
	<li>getMinutes(), getSeconds()は0〜59の整数を返す</li>
</ul>
<h4>SAMPLE #084<b>時刻の取得</b></h4>
<pre><code>const date = new Date();
const hour = date.getHours();
const minutes = date.getMinutes();
const seconds = date.getSeconds();

//午前午後の分岐
let meridiem;
let hour2;
if (hour < 12) {
	meridiem='午前';
	hour2=hour;
} else {
	meridiem='午後';
	hour2 = hour - 12;
}

alert(`${meridiem}${hour2}時${minutes}分${seconds}秒です`);</code></pre>
<p class="btn" onclick="sec084()">SAMPLE #084</p>
</section><!-- section -->

<section>
<h2><b>085</b>曜日の取得</h2>
<table>
	<tr>
		<th>メソッド</th>
		<th>意味</th>
		<th>戻り値</th>
	</tr>
	<tr>
		<td>getDay()</td>
		<td>曜日を取得</td>
		<td>数値</td>
	</tr>
</table>
<ul>
	<li>getDay()は0〜6の整数を返す（日曜から0）</li>
</ul>
<h4>SAMPLE #085<b>曜日の取得</b></h4>
<pre><code>const date = new Date();
const day = date.getDay();
const dayList = ['日', '月', '火', '水', '木', '金', '土'];

alert(`今日は${dayList[day]}曜日です`);</code></pre>
<p class="btn" onclick="sec085()">SAMPLE #085</p>
</section><!-- section -->

<section>
<h2><b>086</b>日本式表記の時刻の取得</h2>
<table>
	<tr>
		<th>メソッド</th>
		<th>意味</th>
		<th>戻り値</th>
	</tr>
	<tr>
		<td>toLocaleString()</td>
		<td>日付時刻の文字列を取得</td>
		<td>文字列</td>
	</tr>
	<tr>
		<td>toLocaleDateString()</td>
		<td>日付の文字列を取得</td>
		<td>文字列</td>
	</tr>
	<tr>
		<td>toLocaleTimeString()</td>
		<td>時刻の文字列を取得</td>
		<td>文字列</td>
	</tr>
</table>
<ul>
	<li>toLocaleString()を使うと利用者の言語環境にあわせた日付時刻情報が得られる</li>
</ul>
<h4>SAMPLE #086<b>toLocaleString()の例</b></h4>
<pre><code>const date = new Date();
const locale = date.toLocaleString();
const localeDate = date.toLocaleDateString();
const localeTime = date.toLocaleTimeString();

alert(`【toLocaleString()】
${locale}
【toLocaleDateString()】
${localeDate}
【toLocaleTimeString()】
${localeTime}`);</code></pre>
<p class="btn" onclick="sec086()">SAMPLE #086</p>
</section><!-- section -->

<section>
<h2><b>087</b>日付文字列からタイムスタンプ値を取得</h2>
<table>
	<tr>
		<th>メソッド</th>
		<th>意味</th>
		<th>戻り値</th>
	</tr>
	<tr>
		<td>Date.parse()</td>
		<td>日付文字列からタイムスタンプ値を取得</td>
		<td>数値</td>
	</tr>
	<tr>
		<td>Date.now()</td>
		<td>現在時刻のタイムスタンプ値を取得</td>
		<td>数値</td>
	</tr>
</table>
<ul>
	<li>タイムスタンプとは協定世界時での1970年1月1日0時0分0秒から現在までの経過時間（単位はミリ秒）</li>
</ul>
<pre><code>const num = Date.parse('2018/06/20');
console.log(num);    //1529420400000</code></pre>
<h4>SAMPLE #087<b>Date.now()</b></h4>
<pre><code>const num = Date.now();
alert(num);</code></pre>
<p class="btn" onclick="sec087()">SAMPLE #087</p>
</section><!-- section -->

<section>
<h2><b>088</b>Dateインスタンスに別の日時を設定</h2>
<ul>
	<li>Dateインスタンスに日時を設定できる</li>
	<li>任意の日時を設定しておくことで、日時に関するデータ加工に対応できる</li>
</ul>
<h3>コンストラクターで設定</h3>
<ul>
	<li>コンストラクターに引数を指定</li>
	<li>文字列・数値・タイムスタンプで指定できる</li>
</ul>
<pre><code>//文字列で指定
const date1 = new Date('2018/06/12 20:01:10');
const date2 = new Date('Tue Jun 12 2018 20:01:10');

//数値で指定
//年・月（0〜11で指定）・日・時・分・秒・ミリ秒の順番
const date3 = new Date(2018, 5, 12, 20, 1, 10);

//タイムスタンプで指定
//1970年1月1日0時0分0秒からの経過ミリ秒を使用
const date4 = new Date(1528801270000);
</code></pre>
<h3>メソッドで設定</h3>
<ul>
	<li>Dateオブジェクトにはset●●●()という名前で年・月・日・時・分・秒・ミリ秒を指定できるメソッドがある</li>
	<li>引数には数値を指定</li>
</ul>
<table>
	<tr>
		<th>メソッド</th>
		<th>意味</th>
		<th>戻り値</th>
	</tr>
	<tr>
		<td>setFullYear(西暦)</td>
		<td>西暦を設定</td>
		<td>なし</td>
	</tr>
	<tr>
		<td>setMonth(月)（0〜11で指定）</td>
		<td>月を設定</td>
		<td>なし</td>
	</tr>
	<tr>
		<td>setDate(日)</td>
		<td>日を設定</td>
		<td>なし</td>
	</tr>
	<tr>
		<td>setHours(時)</td>
		<td>時を設定</td>
		<td>なし</td>
	</tr>
	<tr>
		<td>setMinutes(分)</td>
		<td>分を設定</td>
		<td>なし</td>
	</tr>
	<tr>
		<td>setSeconds(秒)</td>
		<td>秒を設定</td>
		<td>なし</td>
	</tr>
	<tr>
		<td>setMilliseconds(ミリ秒)</td>
		<td>ミリ秒を設定</td>
		<td>なし</td>
	</tr>
</table>
<pre><code>const date = new Date();
//日時を設定
date.setFullYear(2015);
date.setMonth(0);
date.setDate(1);
date.setHours(0);
date.setMinutes(0);
date.setSeconds(0);

alert(date.toLocaleString());    //2015/1/1 0:00:00
</code></pre>
</section><!-- section -->

<section>
<h2><b>089</b>日付・時刻値を加算・減算したい</h2>
<ul>
	<li>日付の取得と設定のメソッドを使うことで、●ヶ月前や●日後の日付を求められる</li>
</ul>
<h4>SAMPLE #089<b>日付・時刻の加算・減算</b></h4>
<pre><code>const date089 = new Date();
let inputMonth, inputDate;
//入力値取得
function inputValue() {
	inputMonth = parseInt(document.querySelector('#inputMonth').value);
	inputDate = parseInt(document.querySelector('#inputDate').value);
	//空白の場合
	if (isNaN(inputMonth)) {
		inputMonth = 0;
	}
	if (isNaN(inputDate)) {
		inputDate = 0;
	}
}
//減算
function prev() {
	date089.setMonth(date089.getMonth() - inputMonth);
	date089.setDate(date089.getDate() - inputDate);
}
//加算
function next() {
	date089.setMonth(date089.getMonth() + inputMonth);
	date089.setDate(date089.getDate() + inputDate);
}
//過去出力
function sec089prev() {
	inputValue();
	prev();
	alert(`${inputMonth}ヶ月${inputDate}日前は${date089.toLocaleDateString()}`);
	next();
}
//未来出力
function sec089next() {
	inputValue();
	next();
	alert(`${inputMonth}ヶ月${inputDate}日後は${date089.toLocaleDateString()}`);
	prev();
}</code></pre>
<form action="">
	<input type="text" id="inputMonth" placeholder="月">
	<input type="text" id="inputDate" placeholder="日">
</form>
<p class="btn prev" onclick="sec089prev()">●ヶ月●日前</p>
<p class="btn next" onclick="sec089next()">●ヶ月●日後</p>
</section><!-- section -->

<section>
<h2><b>090</b>日付・時刻の差分を計算する</h2>
<ul>
	<li>比較したい日付・時間のDateインスタンスを用意し、getTime()でミリ秒を求める</li>
	<li>ミリ秒のままだとわかりづらいので、目的とする単位に変換する</li>
</ul>
<h3>日数の場合（24*60*60*1000）で差分を除算</h3>
<pre><code>const dateA = new Date('2018/06/01 10:00:00');
const dateB = new Date('2018/05/01 07:50:00');
const diffMSec = dateA.getTime() - dateB.getTime();
const diffDate = diffMSec / (24 * 60 * 60 * 1000);
const diffHour = diffMSec / (60 * 60 * 1000);
const diffMin = diffMSec / (60 * 1000);
alert(`${diffDate}日の差があります。`);    //31.09027777777778日の差があります。
alert(`${diffHour}時間の差があります。`);    //746.1666666666666時間の差があります。
alert(`${diffMin}分の差があります。`);    //44770分の差があります。
</code></pre>
<h4>SAMPLE #090<b>日付の差分を計算</b></h4>
<pre><code>const inputDateA = document.querySelector('#inputDateA').value;
const inputDateB = document.querySelector('#inputDateB').value;
const dateA = new Date(inputDateA);
const dateB = new Date(inputDateB);
const diffMSec = dateA.getTime() - dateB.getTime();
let diffDate = diffMSec / (24 * 60 * 60 * 1000);
//空白のチェック
if (isNaN(diffDate)) {
	alert(`日付を選択してください`);
} else {
	alert(`${diffDate}日の差があります。`);
}</code></pre>
<form action="">
	<input type="date" id="inputDateA">と<input type="date" id="inputDateB">を比較
</form>
<p class="btn" onclick="sec090()">SAMPLE #090</p>
</section><!-- section -->

<section>
<h2><b>091</b>経過時間を調べる</h2>
<table>
	<tr>
		<th>メソッド</th>
		<th>意味</th>
		<th>戻り値</th>
	</tr>
	<tr>
		<td>Date.now()</td>
		<td>現在の時間を基準時からのミリ秒数で取得</td>
		<td>数値</td>
	</tr>
</table>
<h4>SAMPLE #091<b>経過時間を調べる</b></h4>
<pre><code>const oldTime = Date.now();    //スタートの時間を取得

setInterval(() => {
	const currentTime = Date.now();    //1秒ごとに時間を取得
	const diff = currentTime - oldTime;    //経過したミリ秒
	const sec = Math.floor(diff / 1000);    //秒数に変換
	document.querySelector('.time091').innerHTML = `${sec}秒が経過`;
}, 1000);</code></pre>
<p class="btn" onclick="sec091()" id="btn091">#091 START</p>
<p class="time091" style="font-size: 30px; font-weight: bold;"></p>
</section><!-- section -->

<section>
<h2><b>092</b>カウントダウン処理</h2>
<table>
	<tr>
		<th>メソッド</th>
		<th>意味</th>
	</tr>
	<tr>
		<td>setInterval(関数, ミリ秒)</td>
		<td>ミリ秒後に引数の関数を実行</td>
	</tr>
</table>
<ul>
	<li>目標時間から経過時間を引き算することでカウントダウンとなる</li>
</ul>
<h4>SAMPLE #092<b>カウントダウン</b></h4>
<pre><code>const totalT = 10000;    //10秒
const oldT = Date.now();

const timerId = setInterval(() => {
	const currentT = Date.now();    //1秒ごとに時間を取得
	const diffT = currentT - oldT;    //経過したミリ秒
	const remainMSec = totalT - diffT;    //残りミリ秒
	const remainSec = Math.ceil(remainMSec / 1000);    //秒数に変換
	let label = `残り${remainSec}秒`;

	//0秒以下になったら
	if (remainSec <= 0) {
		clearInterval(timerId);
		label=`終了`;
	}
	document.querySelector('.time092').innerHTML = label;
},1000);</code></pre>
<p class="btn" onclick="sec092()" id="btn092">#092 START</p>
<p class="time092" style="font-size: 30px; font-weight: bold;"></p>
</section><!-- section -->

<section>
<h2><b>093</b>アナログ時計の表示</h2>
<h4>SAMPLE #093<b>アナログ時計の表示</b></h4>
<ul>
	<li>現在時刻を取得</li>
	<li>時間・分・秒を取得</li>
	<li>取得した値を針の角度に反映</li>
	<li>角度をstyleのtransform:rotate(deg)に代入</li>
	<li>以上をsetIntervalで繰り返す</li>
</ul>
<div class="clock">
	<div class="lineHour"></div>
	<div class="lineMin"></div>
	<div class="lineSec"></div>
</div>
</section><!-- section -->

	<style>
		.clock {
			margin-top: 50px;
			border-radius: 50%;
			border: solid 3px #fff;
			width: 400px;
			height: 400px;
			background: rgba(255, 255, 255, 0.1);
			position: relative;
		}
		.lineHour {
			width: 10px;
			height: 150px;
			background: #fff;
			position: absolute;
			top: calc(50% - 150px);
			left: calc(50% - 5px);
			transform-origin: bottom;
		}
		.lineMin {
			width: 4px;
			height: 200px;
			background: #fff;
			position: absolute;
			top: calc(50% - 200px);
			left: calc(50% - 2px);
			transform-origin: bottom;
		}
		.lineSec {
			width: 2px;
			height: 200px;
			background: #ccc;
			position: absolute;
			top: calc(50% - 200px);
			left: calc(50% - 1px);
			transform-origin: bottom;
		}
	</style>
	<script src="../js/05.js"></script>
</body>

</html>